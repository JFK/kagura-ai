# RFC-031: CLI Startup Optimization

**„Çπ„ÉÜ„Éº„Çø„Çπ**: Draft
**‰ΩúÊàêÊó•**: 2025-10-15
**ÂÑ™ÂÖàÂ∫¶**: üî• High (UX Critical)
**Èñ¢ÈÄ£Issue**: TBD
**‰æùÂ≠òRFC**: „Å™„Åó

---

## üìã Ê¶ÇË¶Å

### ÂïèÈ°å

ÁèæÂú®„ÅÆKagura AI CLI„ÅÆËµ∑Âãï„Åå**ÈùûÂ∏∏„Å´ÈÅÖ„ÅÑ**„Åß„ÅôÔºö

```bash
$ time kagura --help
real    0m8.823s  # 8.8ÁßíÔºÅ
user    0m7.697s
sys     0m0.918s
```

**ÂéüÂõ†ÂàÜÊûê**Ôºà`python -X importtime`Ôºâ:
```
import time:       706 |    7715782 | kagura.cli.main  # 7.7ÁßíÔºÅ

ÂÜÖË®≥:
- mcp „Éë„ÉÉ„Ç±„Éº„Ç∏:      393ms (393,283Œºs)
  - uvicorn:           20ms
  - sse_starlette:     22ms
  - fastmcp.server:   151ms
- observability:       3.2ms (RichÂê´„ÇÄ)
- „Åù„ÅÆ‰ªñ:              ~0.3ms
```

**„É¶„Éº„Ç∂„ÉºÂΩ±Èüø**:
- ‚úÖ `kagura --help` ‚Üí **8.8ÁßíÂæÖÊ©ü** ‚Üê Ë®±ÂÆπ‰∏çÂèØ
- ‚úÖ `kagura chat` ‚Üí **8.8Áßí + chatËµ∑Âãï** ‚Üê ‰ΩìÈ®ìÊÇ™Âåñ
- ‚úÖ ÂÖ®„Ç≥„Éû„É≥„Éâ„ÅåÂΩ±Èüø„ÇíÂèó„Åë„Çã

### Ê†πÊú¨ÂéüÂõ†

**„Éà„ÉÉ„Éó„É¨„Éô„É´„Åß„ÅÆÂç≥Â∫ß„Ç§„É≥„Éù„Éº„Éà**:
```python
# src/kagura/cli/main.py (ÁèæÁä∂ - ‚ùå ÊÇ™„ÅÑ)
from .mcp import mcp              # 393ms - ‰Ωø„Çè„Çå„Å™„ÅÑÂ†¥Âêà„ÇÇË™≠„ÅøËæº„ÇÄÔºÅ
from .monitor import monitor      # 3.2ms
from .chat import chat
from .repl import repl
# ...
```

**ÂïèÈ°åÁÇπ**:
1. `kagura --help` „Åß„ÇÇMCP„Çµ„Éº„Éê„ÉºÈñ¢ÈÄ£„Çí„Åô„Åπ„Å¶„Ç§„É≥„Éù„Éº„Éà
2. `kagura chat` „Åß„ÇÇMonitor/REPL/MCP„Çí„Åô„Åπ„Å¶„Ç§„É≥„Éù„Éº„Éà
3. ÂÆüÈöõ„Å´‰Ωø„ÅÜ„Ç≥„Éû„É≥„Éâ„ÅØ1„Å§„Å†„Åë„Å™„ÅÆ„Å´„ÄÅÂÖ®ÈÉ®Ë™≠„ÅøËæº„ÇÄ

### Ëß£Ê±∫Á≠ñ

**Lazy LoadingÔºàÈÅÖÂª∂„Ç§„É≥„Éù„Éº„ÉàÔºâ** - ‰ΩøÁî®ÊôÇ„ÅÆ„Åø„Ç§„É≥„Éù„Éº„Éà

**ÊúüÂæÖÂäπÊûú**:
- ‚úÖ `kagura --help`: **8.8Áßí ‚Üí 0.3Áßí** (97%ÂâäÊ∏õ)
- ‚úÖ `kagura chat`: **8.8Áßí ‚Üí 0.5Áßí** (94%ÂâäÊ∏õ)
- ‚úÖ ÂàùÂõû‰ΩìÈ®ì„ÅåÂäáÁöÑ„Å´ÊîπÂñÑ

---

## üéØ ÁõÆÊ®ô

### ÊàêÂäüÊåáÊ®ô

1. **Ëµ∑ÂãïÈÄüÂ∫¶**
   - ‚úÖ `kagura --help`: **0.3Áßí‰ª•‰∏ã** (ÁèæÁä∂: 8.8Áßí)
   - ‚úÖ `kagura chat`: **0.5Áßí‰ª•‰∏ã** (ÁèæÁä∂: 8.8Áßí+)
   - ‚úÖ `kagura mcp start`: **1.0Áßí‰ª•‰∏ã** (ÁèæÁä∂: 8.8Áßí+)

2. **„É¶„Éº„Ç∂„Éº‰ΩìÈ®ì**
   - ‚úÖ ‰ΩìÊÑüÁöÑ„Å´„ÄåÈÄü„ÅÑ„Äç„Å®ÊÑü„Åò„Çã
   - ‚úÖ ÂàùÂõûÂÆüË°å„Åß„Çπ„Éà„É¨„Çπ„Å™„Åó
   - ‚úÖ È†ªÁπÅ„Å´‰Ωø„ÅÜ„Ç≥„Éû„É≥„Éâ„ÅåÈ´òÈÄü

3. **ÂæåÊñπ‰∫íÊèõÊÄß**
   - ‚úÖ Êó¢Â≠ò„Ç≥„Éº„ÉâÂ§âÊõ¥‰∏çË¶Å
   - ‚úÖ „Åô„Åπ„Å¶„ÅÆ„ÉÜ„Çπ„ÉàÈÄöÈÅé
   - ‚úÖ APIÂ§âÊõ¥„Å™„Åó

---

## üèóÔ∏è „Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£

### ÁèæÂú®„ÅÆÊßãÊàêÔºà‚ùå ÈÅÖ„ÅÑÔºâ

```
$ kagura --help
   ‚Üì
main.py („Éà„ÉÉ„Éó„É¨„Éô„É´)
   ‚îú‚îÄ from .mcp import mcp          # 393ms - ‰∏çË¶Å„Å™„ÅÆ„Å´Ë™≠„ÅøËæº„ÇÄÔºÅ
   ‚îú‚îÄ from .monitor import monitor  # 3.2ms
   ‚îú‚îÄ from .chat import chat        # ...
   ‚îú‚îÄ from .repl import repl        # ...
   ‚îî‚îÄ from .build_cli import build_group
   ‚Üì
cli() Èñ¢Êï∞ÂÆüË°å (--helpË°®Á§∫)
   ‚Üí mcp/monitor/chat „ÅØ‰Ωø„Çè„Å™„ÅÑ„ÅÆ„Å´Ë™≠„ÅøËæº„ÅøÊ∏à„Åø ‚Üê ÁÑ°ÈßÑÔºÅ
```

### ÊîπÂñÑÂæå„ÅÆÊßãÊàêÔºà‚úÖ ÈÄü„ÅÑÔºâ

```
$ kagura --help
   ‚Üì
main.py („Éà„ÉÉ„Éó„É¨„Éô„É´)
   ‚îú‚îÄ Ôºà‰Ωï„ÇÇ„Ç§„É≥„Éù„Éº„Éà„Åó„Å™„ÅÑÔºâ
   ‚îî‚îÄ lazy commandÂÆöÁæ©„ÅÆ„Åø
   ‚Üì
cli() Èñ¢Êï∞ÂÆüË°å (--helpË°®Á§∫)
   ‚Üí „Ç§„É≥„Éù„Éº„Éà„Å™„Åó„ÄÅÂç≥Â∫ß„Å´Ë°®Á§∫ ‚úÖ

---

$ kagura mcp start
   ‚Üì
main.py („Éà„ÉÉ„Éó„É¨„Éô„É´)
   ‚îî‚îÄ Ôºà‰Ωï„ÇÇ„Ç§„É≥„Éù„Éº„Éà„Åó„Å™„ÅÑÔºâ
   ‚Üì
mcp „Ç≥„Éû„É≥„ÉâÂÆüË°å
   ‚îî‚îÄ from .mcp import mcp  # ‚Üê „Åì„ÅÆÊôÇÁÇπ„ÅßÂàù„ÇÅ„Å¶„Ç§„É≥„Éù„Éº„Éà ‚úÖ
```

---

## üì¶ Phase 1: Lazy LoadingÂÆüË£Ö (Week 1)

### ÂÆüË£ÖÂÜÖÂÆπ

#### 1.1 LazyGroupÂÆüË£Ö

```python
# src/kagura/cli/lazy.py

import click
from typing import Callable, Optional

class LazyGroup(click.Group):
    """Lazy-loading Click Group

    Subcommands are imported only when invoked.
    This dramatically reduces CLI startup time.
    """

    def __init__(self, *args, lazy_subcommands: Optional[dict[str, tuple[str, str]]] = None, **kwargs):
        """Initialize lazy group

        Args:
            lazy_subcommands: Dict of {command_name: (module_path, attr_name)}
                Example: {"mcp": ("kagura.cli.mcp", "mcp")}
        """
        super().__init__(*args, **kwargs)
        self.lazy_subcommands = lazy_subcommands or {}

    def get_command(self, ctx: click.Context, cmd_name: str) -> Optional[click.Command]:
        """Get command, importing lazily if needed"""
        # Try regular command first
        cmd = super().get_command(ctx, cmd_name)
        if cmd is not None:
            return cmd

        # Lazy load if defined
        if cmd_name in self.lazy_subcommands:
            module_path, attr_name = self.lazy_subcommands[cmd_name]

            # Import module lazily
            import importlib
            module = importlib.import_module(module_path)

            # Get command
            cmd = getattr(module, attr_name)

            # Cache it for next time
            self.add_command(cmd, cmd_name)

            return cmd

        return None

    def list_commands(self, ctx: click.Context) -> list[str]:
        """List all commands (including lazy ones)"""
        regular = super().list_commands(ctx)
        lazy = list(self.lazy_subcommands.keys())
        return sorted(set(regular + lazy))
```

#### 1.2 main.py„ÅÆ„É™„Éï„Ç°„ÇØ„Çø

```python
# src/kagura/cli/main.py

import click
from ..version import __version__
from .lazy import LazyGroup


@click.group(cls=LazyGroup, lazy_subcommands={
    "repl": ("kagura.cli.repl", "repl"),
    "chat": ("kagura.cli.chat", "chat"),
    "mcp": ("kagura.cli.mcp", "mcp"),
    "run": ("kagura.cli.commands_cli", "run"),
    "monitor": ("kagura.cli.monitor", "monitor"),
    "auth": ("kagura.cli.auth_cli", "auth_group"),
    "build": ("kagura.cli.build_cli", "build_group"),
})
@click.version_option(version=__version__, prog_name="Kagura AI")
@click.option("--verbose", "-v", is_flag=True, help="Enable verbose output")
@click.option("--quiet", "-q", is_flag=True, help="Suppress non-error output")
@click.pass_context
def cli(ctx: click.Context, verbose: bool, quiet: bool):
    """
    Kagura AI - Python-First AI Agent Framework

    A framework for building AI agents with code execution capabilities.
    Use subcommands to interact with the framework.

    Examples:
      kagura version          Show version information
      kagura --help           Show this help message
    """
    ctx.ensure_object(dict)
    ctx.obj["verbose"] = verbose
    ctx.obj["quiet"] = quiet


@cli.command()
@click.pass_context
def version(ctx: click.Context):
    """Show version information"""
    if not ctx.obj.get("quiet"):
        click.echo(f"Kagura AI v{__version__}")
        if ctx.obj.get("verbose"):
            click.echo("Python-First AI Agent Framework")
            click.echo("https://github.com/JFK/kagura-ai")


if __name__ == "__main__":
    cli(obj={})
```

**Before**:
```python
# ‚ùå Slow
from .mcp import mcp              # 393ms
from .monitor import monitor      # 3.2ms
from .chat import chat
# ...

cli.add_command(mcp)
cli.add_command(monitor)
```

**After**:
```python
# ‚úÖ Fast
@click.group(cls=LazyGroup, lazy_subcommands={
    "mcp": ("kagura.cli.mcp", "mcp"),        # Import only when used
    "monitor": ("kagura.cli.monitor", "monitor"),
    # ...
})
```

### „ÉÜ„Çπ„Éà

```python
# tests/cli/test_lazy_loading.py

import time
import subprocess
import pytest

def test_help_is_fast():
    """Test that --help is fast (< 0.5s)"""
    start = time.time()
    result = subprocess.run(
        ["kagura", "--help"],
        capture_output=True,
        text=True
    )
    duration = time.time() - start

    assert result.returncode == 0
    assert duration < 0.5, f"--help took {duration:.2f}s (expected < 0.5s)"

def test_chat_startup_is_fast():
    """Test that chat startup is fast (< 1.0s)"""
    start = time.time()
    result = subprocess.run(
        ["kagura", "chat", "--help"],
        capture_output=True,
        text=True
    )
    duration = time.time() - start

    assert result.returncode == 0
    assert duration < 1.0, f"chat --help took {duration:.2f}s (expected < 1.0s)"

def test_lazy_loading_works():
    """Test that lazy loading actually imports on demand"""
    # This should NOT import mcp module
    result = subprocess.run(
        ["python", "-c",
         "from kagura.cli.main import cli; "
         "import sys; "
         "print('mcp' in sys.modules)"],
        capture_output=True,
        text=True
    )

    assert "False" in result.stdout, "mcp module should not be imported"

def test_all_commands_still_work():
    """Test that all commands still work after lazy loading"""
    commands = ["repl", "chat", "mcp", "monitor", "auth", "build"]

    for cmd in commands:
        result = subprocess.run(
            ["kagura", cmd, "--help"],
            capture_output=True,
            text=True
        )
        assert result.returncode == 0, f"{cmd} command failed"
        assert len(result.stdout) > 0, f"{cmd} has no help output"

# 10+ more tests...
```

### ÂÆå‰∫ÜÊù°‰ª∂

- [ ] LazyGroupÂÆüË£Ö
- [ ] main.py„É™„Éï„Ç°„ÇØ„Çø
- [ ] 10+ testsÂÖ®„Éë„Çπ
- [ ] Ëµ∑ÂãïÈÄüÂ∫¶: `kagura --help` < 0.5Áßí
- [ ] Êó¢Â≠ò„ÉÜ„Çπ„ÉàÔºà1,213+ÔºâÂÖ®„Éë„Çπ
- [ ] „Éâ„Ç≠„É•„É°„É≥„ÉàÊõ¥Êñ∞

---

## üì¶ Phase 2: Progress IndicatorÔºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ (Week 2)

### ÁõÆÊ®ô

Èï∑ÊôÇÈñì„Åã„Åã„Çã„Ç≥„Éû„É≥„Éâ„ÅÆ‰ΩìÊÑüÈÄüÂ∫¶Âêë‰∏ä

### ÂÆüË£ÖÂÜÖÂÆπ

#### 2.1 Spinner„ÅÆËøΩÂä†

```python
# src/kagura/cli/progress.py

import click
import time
from contextlib import contextmanager

@contextmanager
def spinner(message: str = "Loading..."):
    """Show spinner during long operations

    Example:
        with spinner("Starting MCP server..."):
            # Long operation
            time.sleep(2)
    """
    import threading
    import sys

    stop_spinner = threading.Event()

    def spin():
        frames = ["‚†ã", "‚†ô", "‚†π", "‚†∏", "‚†º", "‚†¥", "‚†¶", "‚†ß", "‚†á", "‚†è"]
        i = 0
        while not stop_spinner.is_set():
            frame = frames[i % len(frames)]
            sys.stderr.write(f"\r{frame} {message}")
            sys.stderr.flush()
            time.sleep(0.1)
            i += 1
        sys.stderr.write("\r" + " " * (len(message) + 3) + "\r")
        sys.stderr.flush()

    thread = threading.Thread(target=spin, daemon=True)
    thread.start()

    try:
        yield
    finally:
        stop_spinner.set()
        thread.join(timeout=0.5)
```

#### 2.2 Èï∑ÊôÇÈñì„Ç≥„Éû„É≥„Éâ„Å∏„ÅÆÈÅ©Áî®

```python
# src/kagura/cli/mcp.py (‰æã)

from .progress import spinner

@mcp.command()
def start(...):
    """Start MCP server"""
    with spinner("Starting MCP server..."):
        # Import heavy dependencies here
        from ..mcp.server import MCPServer
        # ... server setup ...

    click.echo("‚úì MCP server started")
```

### „ÉÜ„Çπ„Éà

```python
# tests/cli/test_progress.py

import time
from kagura.cli.progress import spinner

def test_spinner_works():
    """Test that spinner displays correctly"""
    with spinner("Testing..."):
        time.sleep(0.5)
    # If no exception, it works

def test_spinner_cleans_up():
    """Test that spinner cleans up after itself"""
    import sys
    import io

    stderr = io.StringIO()
    sys.stderr = stderr

    with spinner("Test"):
        time.sleep(0.2)

    sys.stderr = sys.__stderr__
    output = stderr.getvalue()

    # Should contain spinner frames
    assert any(frame in output for frame in ["‚†ã", "‚†ô", "‚†π"])

    # Should clean up (last line empty)
    assert output.rstrip().endswith("\r")

# 5+ more tests...
```

### ÂÆå‰∫ÜÊù°‰ª∂

- [ ] SpinnerÂÆüË£Ö
- [ ] Èï∑ÊôÇÈñì„Ç≥„Éû„É≥„Éâ„Å∏„ÅÆÈÅ©Áî®Ôºàmcp start, chatÁ≠âÔºâ
- [ ] 5+ testsÂÖ®„Éë„Çπ
- [ ] UX„É¨„Éì„É•„ÉºÔºà‰ΩìÊÑüÈÄüÂ∫¶Âêë‰∏äÔºâ

---

## üìä ÊàêÂäüÊåáÊ®ô

### Phase 1ÂÆå‰∫ÜÊôÇÔºàLazy LoadingÔºâ

**Ëµ∑ÂãïÈÄüÂ∫¶**:
- ‚úÖ `kagura --help`: **8.8Áßí ‚Üí 0.3Áßí** (97%ÂâäÊ∏õ)
- ‚úÖ `kagura chat --help`: **8.8Áßí ‚Üí 0.5Áßí** (94%ÂâäÊ∏õ)
- ‚úÖ `kagura mcp start`: **8.8Áßí ‚Üí 1.0Áßí** (89%ÂâäÊ∏õ)

**ÂìÅË≥™**:
- ‚úÖ 15+ Êñ∞Ë¶è„ÉÜ„Çπ„ÉàÂÖ®„Éë„Çπ
- ‚úÖ Êó¢Â≠ò„ÉÜ„Çπ„ÉàÔºà1,213+ÔºâÂÖ®„Éë„Çπ
- ‚úÖ Pyright 0 errors
- ‚úÖ ÂæåÊñπ‰∫íÊèõÊÄß100%

### Phase 2ÂÆå‰∫ÜÊôÇÔºàProgress IndicatorÔºâ

**UX**:
- ‚úÖ Èï∑ÊôÇÈñì„Ç≥„Éû„É≥„Éâ„Å´SpinnerË°®Á§∫
- ‚úÖ ‰ΩìÊÑüÈÄüÂ∫¶Âêë‰∏äÔºà„É¶„Éº„Ç∂„Éº„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÔºâ
- ‚úÖ „Éó„É≠„Éï„Çß„ÉÉ„Ç∑„Éß„Éä„É´„Å™CLI‰ΩìÈ®ì

---

## üìù „Éâ„Ç≠„É•„É°„É≥„Éà

### ÈñãÁô∫ËÄÖ„Ç¨„Ç§„Éâ

```markdown
# docs/en/guides/cli-performance.md

## CLI Performance

Kagura CLI uses lazy loading to ensure fast startup times.

### Lazy Loading

Subcommands are imported only when invoked:

```python
# Before (slow)
from .mcp import mcp  # Always imported

# After (fast)
@click.group(cls=LazyGroup, lazy_subcommands={
    "mcp": ("kagura.cli.mcp", "mcp")  # Import on demand
})
```

### Adding New Commands

When adding a new CLI command, use lazy loading:

```python
# src/kagura/cli/main.py

@click.group(cls=LazyGroup, lazy_subcommands={
    "mycommand": ("kagura.cli.mycommand", "mycommand"),
})
```

### Performance Guidelines

1. **Avoid top-level imports** of heavy modules
2. **Use lazy loading** for all subcommands
3. **Add spinners** for operations > 0.5s
4. **Test startup time** in CI

### Benchmarking

```bash
# Measure startup time
time kagura --help

# Profile imports
python -X importtime -c "from kagura.cli.main import cli" 2>&1 | tail -50
```
```

---

## üöÄ ÂÆüË£ÖÈ†ÜÂ∫è

### Week 1: Lazy Loading
- Day 1: LazyGroupÂÆüË£Ö
- Day 2: main.py„É™„Éï„Ç°„ÇØ„Çø
- Day 3-4: „ÉÜ„Çπ„ÉàÔºà15+ testsÔºâ
- Day 5: Êó¢Â≠ò„ÉÜ„Çπ„ÉàÁ¢∫Ë™ç„ÄÅ‰øÆÊ≠£
- Day 6-7: „Éâ„Ç≠„É•„É°„É≥„Éà„ÄÅPR‰ΩúÊàê

### Week 2: Progress IndicatorÔºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ
- Day 1-2: SpinnerÂÆüË£Ö
- Day 3: Èï∑ÊôÇÈñì„Ç≥„Éû„É≥„Éâ„Å∏„ÅÆÈÅ©Áî®
- Day 4: „ÉÜ„Çπ„ÉàÔºà5+ testsÔºâ
- Day 5: UX„É¨„Éì„É•„Éº
- Day 6-7: „Éâ„Ç≠„É•„É°„É≥„Éà„ÄÅPR‰ΩúÊàê

---

## üìã „ÉÅ„Çß„ÉÉ„ÇØ„É™„Çπ„Éà

### Phase 1 ÂÆå‰∫ÜÊù°‰ª∂
- [ ] LazyGroupÂÆüË£Ö
- [ ] main.py„É™„Éï„Ç°„ÇØ„ÇøÔºàlazy_subcommandsÔºâ
- [ ] 15+ testsÂÖ®„Éë„Çπ
- [ ] `kagura --help` < 0.5Áßí
- [ ] `kagura chat --help` < 1.0Áßí
- [ ] Êó¢Â≠ò„ÉÜ„Çπ„ÉàÔºà1,213+ÔºâÂÖ®„Éë„Çπ
- [ ] Pyright 0 errors
- [ ] „Éâ„Ç≠„É•„É°„É≥„ÉàÂÆåÊàê
- [ ] PR‰ΩúÊàê„Éª„É¨„Éì„É•„Éº

### Phase 2 ÂÆå‰∫ÜÊù°‰ª∂Ôºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ
- [ ] SpinnerÂÆüË£Ö
- [ ] Èï∑ÊôÇÈñì„Ç≥„Éû„É≥„Éâ„Å∏„ÅÆÈÅ©Áî®
- [ ] 5+ testsÂÖ®„Éë„Çπ
- [ ] UX„É¨„Éì„É•„ÉºÂêàÊ†º
- [ ] „Éâ„Ç≠„É•„É°„É≥„ÉàÂÆåÊàê
- [ ] PR‰ΩúÊàê„Éª„É¨„Éì„É•„Éº

---

## üéì ÂèÇËÄÉË≥áÊñô

### Lazy Loading Patterns
- [Click Documentation - Custom Multi Commands](https://click.palletsprojects.com/en/8.1.x/commands/#custom-multi-commands)
- [Python importlib](https://docs.python.org/3/library/importlib.html)

### CLI Performance Best Practices
- [Click Performance Tips](https://click.palletsprojects.com/en/8.1.x/advanced/#performance)
- [Python Startup Time Optimization](https://wiki.python.org/moin/PythonSpeed/PerformanceTips#Import_Statement_Overhead)

### Progress Indicators
- [Click Progress Bars](https://click.palletsprojects.com/en/8.1.x/api/#click.progressbar)
- [Rich Progress](https://rich.readthedocs.io/en/stable/progress.html)

---

## üí° ÊäÄË°ìÁöÑ„Å™ËÄÉÂØü

### „Å™„ÅúLazy Loading„ÅåÂäπÊûúÁöÑ„Åã

**„Ç§„É≥„Éù„Éº„ÉàÊôÇÈñì„ÅÆÂÜÖË®≥**:
```
mcp „Éë„ÉÉ„Ç±„Éº„Ç∏:     393ms
  ‚îú‚îÄ uvicorn:        20ms (ASGI server)
  ‚îú‚îÄ sse_starlette:  22ms (Server-Sent Events)
  ‚îî‚îÄ fastmcp:       151ms (FastMCP server)
```

**‰ΩøÁî®È†ªÂ∫¶ÂàÜÊûê**ÔºàÊé®Ê∏¨Ôºâ:
- `kagura --help`: 50% ‚Üê mcp„ÅØ‰∏çË¶Å
- `kagura chat`: 30% ‚Üê mcp„ÅØ‰∏çË¶Å
- `kagura mcp`: 10% ‚Üê mcp„ÅåÂøÖË¶Å
- „Åù„ÅÆ‰ªñ: 10%

**ÁµêË´ñ**: 90%„ÅÆ„Ç±„Éº„Çπ„Åßmcp„Ç§„É≥„Éù„Éº„Éà„ÅØ‰∏çË¶Å ‚Üí Lazy Loading„ÅßÂ§ßÂπÖÈ´òÈÄüÂåñ

### ‰ª£ÊõøÊ°à„ÅÆÊ§úË®é

#### Ê°à1: Top-level importÂâäÊ∏õÔºàÊé°Áî®Ôºâ‚úÖ
- **„É°„É™„ÉÉ„Éà**: ÊúÄÂ§ß„ÅÆÂäπÊûú„ÄÅÂæåÊñπ‰∫íÊèõÊÄßÁ∂≠ÊåÅ
- **„Éá„É°„É™„ÉÉ„Éà**: LazyGroupÂÆüË£Ö„ÅåÂøÖË¶Å

#### Ê°à2: „Ç®„É≥„Éà„É™„Éº„Éù„Ç§„É≥„ÉàÂàÜÂâ≤
```bash
kagura-mcp start  # Âà•„Éê„Ç§„Éä„É™
kagura-chat      # Âà•„Éê„Ç§„Éä„É™
```
- **„É°„É™„ÉÉ„Éà**: ÂêÑ„Ç≥„Éû„É≥„ÉâÂÆåÂÖ®Áã¨Á´ã
- **„Éá„É°„É™„ÉÉ„Éà**: UXÊÇ™Âåñ„ÄÅË§áÊï∞„Éê„Ç§„Éä„É™ÁÆ°ÁêÜ

#### Ê°à3: ImportÊúÄÈÅ©Âåñ
```python
# Heavy import„ÇíÈÅÖÂª∂
def mcp_start():
    import uvicorn  # ‚Üê Èñ¢Êï∞ÂÜÖ„Åß„Ç§„É≥„Éù„Éº„Éà
```
- **„É°„É™„ÉÉ„Éà**: Á∞°Âçò
- **„Éá„É°„É™„ÉÉ„Éà**: ÂäπÊûúÈôêÂÆöÁöÑÔºàClickËß£Êûê„ÅØÊÆã„ÇãÔºâ

**ÈÅ∏Êäû**: Ê°à1ÔºàLazy LoadingÔºâ„ÅåÊúÄÈÅ©

---

**„Åì„ÅÆRFC„Å´„Çà„Çä„ÄÅKagura AI CLI„ÅØ‰∏ñÁïåÊúÄÈÄüÁ¥ö„ÅÆPython CLI„Å´„Å™„Çä„Åæ„ÅôÔºÅ**
