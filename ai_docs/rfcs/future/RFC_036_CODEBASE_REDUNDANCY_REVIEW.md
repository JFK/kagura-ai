# RFC-036: Codebase Redundancy Review & Consolidation

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Draft
**ä½œæˆæ—¥**: 2025-10-16
**å„ªå…ˆåº¦**: â­ï¸â­ï¸ Medium
**å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v2.6.0+
**é–¢é€£Issue**: [#227](https://github.com/JFK/kagura-ai/issues/227)

---

## ğŸ“‹ æ¦‚è¦

Kagura AIã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹å…¨ä½“ã‚’èª¿æŸ»ã—ã€å†—é•·ãªä»•çµ„ã¿ã€é‡è¤‡å®Ÿè£…ã€çµ±åˆå¯èƒ½ãªæ©Ÿèƒ½ã‚’ç‰¹å®šã—ã¦æ•´ç†ã—ã¾ã™ã€‚

---

## ğŸ¯ ç›®æ¨™

### å•é¡Œ

v2.5.10ã«åˆ°é”ã—ã€å¤šãã®æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚ŒãŸãŒã€ä»¥ä¸‹ã®æ‡¸å¿µï¼š

1. **é‡è¤‡å®Ÿè£…**: ä¼¼ãŸæ©Ÿèƒ½ãŒè¤‡æ•°ç®‡æ‰€ã«å­˜åœ¨
2. **å†—é•·ãªæŠ½è±¡åŒ–**: ä¸è¦ãªãƒ©ãƒƒãƒ‘ãƒ¼ã‚„ãƒ¬ã‚¤ãƒ¤ãƒ¼
3. **æœªä½¿ç”¨ã‚³ãƒ¼ãƒ‰**: å‰Šé™¤å¯èƒ½ãªæ©Ÿèƒ½
4. **ä¸€è²«æ€§ã®æ¬ å¦‚**: ä¼¼ãŸå‡¦ç†ã®å®Ÿè£…æ–¹æ³•ãŒãƒãƒ©ãƒãƒ©

### ã‚´ãƒ¼ãƒ«

- âœ… ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ç°¡ç´ åŒ–
- âœ… ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§å‘ä¸Š
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„
- âœ… ä¸€è²«æ€§ç¢ºä¿

---

## ğŸ” èª¿æŸ»å¯¾è±¡é ˜åŸŸ

### 1. ãƒ¡ãƒ¢ãƒªãƒ»RAGã‚·ã‚¹ãƒ†ãƒ 

**ç¾åœ¨ã®å®Ÿè£…**:
```
src/kagura/core/memory/
â”œâ”€â”€ manager.py          # MemoryManager
â”œâ”€â”€ rag.py              # MemoryRAG (ChromaDB)
â”œâ”€â”€ multimodal_rag.py   # MultimodalRAG
â”œâ”€â”€ persistent.py       # PersistentMemory
â””â”€â”€ context.py          # ContextManager
```

**èª¿æŸ»ãƒã‚¤ãƒ³ãƒˆ**:
- MemoryRAG vs MultimodalRAG: çµ±åˆå¯èƒ½ï¼Ÿ
- PersistentMemory: å¿…è¦æ€§ã¯ï¼Ÿ
- ContextManager: MemoryManagerã¨é‡è¤‡ï¼Ÿ

### 2. ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ 

**ç¾åœ¨ã®å®Ÿè£…**:
```
src/kagura/routing/
â”œâ”€â”€ router.py               # AgentRouter
â”œâ”€â”€ memory_aware_router.py  # MemoryAwareRouter
â””â”€â”€ context_analyzer.py     # ContextAnalyzer
```

**èª¿æŸ»ãƒã‚¤ãƒ³ãƒˆ**:
- AgentRouter vs MemoryAwareRouter: çµ±åˆå¯èƒ½ï¼Ÿ
- ContextAnalyzer: å¿…è¦æ€§ã¯ï¼Ÿ

### 3. ãƒ„ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ 

**ç¾åœ¨ã®å®Ÿè£…**:
```
src/kagura/tools/        # YouTubeç­‰
src/kagura/builtin/      # File operations
src/kagura/web/          # Web search/scraper
```

**èª¿æŸ»ãƒã‚¤ãƒ³ãƒˆ**:
- tools/ vs builtin/: çµ±åˆå¯èƒ½ï¼Ÿ
- ä¸€è²«æ€§ã¯ï¼Ÿ

### 4. ãƒ—ãƒªã‚»ãƒƒãƒˆ vs ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

**ç¾åœ¨ã®å®Ÿè£…**:
```
src/kagura/presets/        # Pre-built agents
src/kagura/chat/preset.py  # Chat presets
src/kagura/meta/templates/ # Meta agent templates
```

**èª¿æŸ»ãƒã‚¤ãƒ³ãƒˆ**:
- é‡è¤‡ï¼Ÿçµ±åˆå¯èƒ½ï¼Ÿ

---

## ğŸ“¦ èª¿æŸ»Phase

### Phase 1: ä½¿ç”¨çŠ¶æ³åˆ†æï¼ˆ1é€±é–“ï¼‰

**æ–¹æ³•**:
```bash
# Importåˆ†æ
rg "^from kagura\." --type py | cut -d: -f2 | sort | uniq -c | sort -rn

# æœªä½¿ç”¨ã‚³ãƒ¼ãƒ‰æ¤œå‡º
vulture src/kagura/

# Git logåˆ†æ
git log --all --pretty=format:'%h' --name-only |   grep "src/kagura/" | sort | uniq -c | sort -rn
```

**æˆæœç‰©**:
- ä½¿ç”¨é »åº¦ãƒ¬ãƒãƒ¼ãƒˆ
- æœªä½¿ç”¨ã‚³ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ
- å‰Šé™¤å€™è£œãƒªã‚¹ãƒˆ

### Phase 2: ä¾å­˜é–¢ä¿‚åˆ†æï¼ˆ3æ—¥ï¼‰

**æ–¹æ³•**:
```bash
# ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¾å­˜ã‚°ãƒ©ãƒ•
pydeps src/kagura/ --max-bacon 3

# Circular dependenciesæ¤œå‡º
pydeps src/kagura/ --show-cycles
```

**æˆæœç‰©**:
- ä¾å­˜é–¢ä¿‚å›³
- Circular dependencyå ±å‘Š
- çµ±åˆå€™è£œãƒªã‚¹ãƒˆ

### Phase 3: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨ˆç”»ï¼ˆ2æ—¥ï¼‰

**æˆæœç‰©**:
- çµ±åˆè¨ˆç”»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- å„ªå…ˆé †ä½ä»˜ã‘
- å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### Phase 4: å®Ÿè£…ï¼ˆ2-4é€±é–“ï¼‰

- Phaseã”ã¨ã«åˆ†å‰²å®Ÿè£…
- å¾Œæ–¹äº’æ›æ€§ç¶­æŒ
- æ®µéšçš„ç§»è¡Œ

---

## ğŸ“Š æœŸå¾…ã•ã‚Œã‚‹æˆæœ

### çŸ­æœŸåŠ¹æœ
- âœ… å‰Šé™¤å¯èƒ½ã‚³ãƒ¼ãƒ‰ç‰¹å®š
- âœ… çµ±åˆå€™è£œãƒªã‚¹ãƒˆ
- âœ… ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨ˆç”»

### ä¸­æœŸåŠ¹æœ
- âœ… ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹10-20%å‰Šæ¸›
- âœ… Importæ™‚é–“çŸ­ç¸®
- âœ… ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§å‘ä¸Š

### é•·æœŸåŠ¹æœ
- âœ… æ–°æ©Ÿèƒ½è¿½åŠ ãŒå®¹æ˜“ã«
- âœ… ãƒã‚°ç™ºç”Ÿç‡ä½ä¸‹
- âœ… ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´ç†

---

## ğŸ”’ åˆ¶ç´„

### å¤‰æ›´ç¦æ­¢
- âŒ å…¬é–‹APIï¼ˆBreaking changeç¦æ­¢ï¼‰
- âŒ æ—¢å­˜ã®agentå®šç¾©
- âŒ examples/ï¼ˆPhase 4ã¾ã§ï¼‰

### æ…é‡ã«æ‰±ã†ã¹ã
- âš ï¸ Memory systemï¼ˆå¤šãã®æ©Ÿèƒ½ãŒä¾å­˜ï¼‰
- âš ï¸ LLM integrationï¼ˆã‚³ã‚¢æ©Ÿèƒ½ï¼‰
- âš ï¸ Tool systemï¼ˆæ‹¡å¼µæ€§é‡è¦ï¼‰

---

## ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

**Duration**: 4-6é€±é–“

- Week 1: Phase 1ï¼ˆä½¿ç”¨çŠ¶æ³åˆ†æï¼‰
- Week 2: Phase 2ï¼ˆä¾å­˜é–¢ä¿‚åˆ†æï¼‰
- Week 3: Phase 3ï¼ˆè¨ˆç”»ç­–å®šï¼‰
- Week 4-6: Phase 4ï¼ˆå®Ÿè£…ï¼‰

**Target**: v2.6.0+

---

## âœ… æˆåŠŸæŒ‡æ¨™

- âœ… å†—é•·æ€§ãƒ¬ãƒãƒ¼ãƒˆä½œæˆ
- âœ… çµ±åˆè¨ˆç”»ä½œæˆ
- âœ… å„ªå…ˆé †ä½ä»˜ã‘
- âœ… å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—
- âœ… ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹10-20%å‰Šæ¸›
- âœ… å¾Œæ–¹äº’æ›æ€§ç¶­æŒ

---

## ğŸ”— é–¢é€£

- **Issue #227**: ã“ã®RFC
- **Issue #249**: CLIç°¡ç´ åŒ–ï¼ˆå®Œäº† - 11,000è¡Œå‰Šæ¸›ã®å®Ÿç¸¾ï¼‰

---

**Status**: Draft - èª¿æŸ»ãƒ•ã‚§ãƒ¼ã‚º
**ã“ã®RFCã¯å“è³ªå‘ä¸Šã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§æ”¹å–„ã®ãŸã‚ã®é‡è¦ãªå–ã‚Šçµ„ã¿ã§ã™ã€‚**
