# Kagura AI v2.3.0 実装計画

**開始日**: 2025-10-10
**期間**: 6週間
**リリース予定**: 2025-11-21
**マイルストーンIssue**: [#120](https://github.com/JFK/kagura-ai/issues/120)

---

## 📋 概要

**戦略**: プランA+（マルチモーダル + Web + `kagura chat`統合）

v2.3.0では、以下の3つの主要機能を実装します：

1. **RFC-002: Multimodal RAG**（コア実装）
   - Gemini APIで画像・音声・動画・PDF処理
   - ChromaDBマルチモーダルベクトル検索

2. **RFC-014: Web Integration**
   - Web検索（Brave Search + DuckDuckGo）
   - Webスクレイピング（BeautifulSoup）

3. **`kagura chat`統合 + UX改善**
   - マルチモーダル対応
   - Web統合
   - フル機能版（`--full`）

---

## 📅 実装スケジュール

### Week 1: RFC-002 Phase 1 - Gemini API統合
**Issue**: [#121](https://github.com/JFK/kagura-ai/issues/121)
**期間**: 7日間

#### 実装内容
- `src/kagura/loaders/gemini.py`: GeminiLoader（250行）
  - 画像処理（Gemini Vision API）
  - 音声処理（Gemini Audio API）
  - 動画処理（Gemini Video API）
  - PDF処理（Gemini PDF API）
- `src/kagura/loaders/file_types.py`: ファイル型判定（100行）
- `tests/loaders/test_gemini.py`: 15+テスト
- `pyproject.toml`: multimodal依存関係追加

#### 完了条件
- [x] Gemini API統合動作確認
- [x] 全4種類のメディア処理動作
- [x] 15+テスト（全パス、90%+カバレッジ）

---

### Week 2: RFC-002 Phase 2 - マルチモーダルローダー
**Issue**: [#122](https://github.com/JFK/kagura-ai/issues/122)
**期間**: 7日間

#### 実装内容
- `src/kagura/loaders/directory.py`: DirectoryScanner（200行）
  - 再帰的ディレクトリスキャン
  - ファイル型自動判定
  - 並列処理（asyncio.gather）
  - `.gitignore` / `.kaguraignore` 尊重
- `src/kagura/loaders/cache.py`: LoaderCache（150行）
- `tests/loaders/test_directory.py`: 10+テスト

#### 完了条件
- [x] ディレクトリスキャン動作確認
- [x] 並列処理動作確認（5ファイル同時）
- [x] キャッシング動作確認
- [x] 10+テスト（全パス、90%+カバレッジ）

---

### Week 3: RFC-002 Phase 3 - ChromaDB統合
**Issue**: [#123](https://github.com/JFK/kagura-ai/issues/123)
**期間**: 7日間

#### 実装内容
- `src/kagura/core/memory/multimodal_rag.py`: MultimodalRAG（180行）
  - マルチモーダルベクトル検索
  - メタデータ管理（ファイルタイプ、パス）
- `src/kagura/core/decorators.py`: `@agent`デコレータ統合
- `tests/core/test_multimodal_rag.py`: 12+テスト
- `docs/en/tutorials/13-multimodal-rag.md`: チュートリアル

#### 完了条件
- [x] ChromaDBベクトル検索動作
- [x] `@agent`デコレータ統合動作
- [x] 12+テスト（全パス、90%+カバレッジ）
- [x] ドキュメント完成

---

### Week 4: RFC-014 Phase 1 - Web Search
**Issue**: [#124](https://github.com/JFK/kagura-ai/issues/124)
**期間**: 7日間

#### 実装内容
- `src/kagura/web/search.py`: BraveSearch + DuckDuckGoSearch（200行）
- `src/kagura/web/__init__.py`: `web.search()` API
- `src/kagura/core/decorators.py`: `@web.enable` デコレータ
- 検索結果キャッシング
- `tests/web/test_search.py`: 15+テスト

#### 完了条件
- [x] Brave Search API動作確認
- [x] DuckDuckGoフォールバック動作確認
- [x] `@web.enable`デコレータ動作
- [x] 15+テスト（全パス、90%+カバレッジ）

---

### Week 5: RFC-014 Phase 2 - Web Scraping
**Issue**: [#125](https://github.com/JFK/kagura-ai/issues/125)
**期間**: 7日間

#### 実装内容
- `src/kagura/web/scraper.py`: WebScraper（180行）
  - `fetch()` / `fetch_text()` API
  - `scrape()` API（CSS Selector）
- `src/kagura/web/robots.py`: robots.txt遵守（100行）
- `src/kagura/web/rate_limiter.py`: レート制限（80行）
- `tests/web/test_scraper.py`: 12+テスト
- `docs/en/tutorials/14-web-integration.md`: チュートリアル

#### 完了条件
- [x] BeautifulSoupスクレイピング動作
- [x] robots.txt遵守動作確認
- [x] レート制限動作確認
- [x] 12+テスト（全パス、90%+カバレッジ）
- [x] ドキュメント完成

---

### Week 6: `kagura chat`統合 + UX改善
**Issue**: [#126](https://github.com/JFK/kagura-ai/issues/126)
**期間**: 7日間

#### 実装内容

**Day 1-3: マルチモーダル対応**
- `src/kagura/cli/chat.py`: マルチモーダル統合
- `kagura chat --enable-multimodal --dir <path>`
- 画像・PDF・音声のインライン処理
- プリセット拡張（visual_assistant, audio_transcriber）

**Day 4-5: Web統合**
- `kagura chat --enable-web`
- 自動Web検索判定（LLMベース）
- 検索結果の整形表示
- プリセット拡張（research_agent, news_summarizer）

**Day 6-7: 統合UX**
- `kagura chat --full` でフル機能有効化
- `--estimate-cost` でコスト見積もり
- プログレス表示（Rich progress bar）
- `tests/cli/test_chat_full.py`: 10+統合テスト
- `docs/en/guides/chat-multimodal.md`: ガイド

#### 完了条件
- [x] マルチモーダル対応動作確認
- [x] Web統合動作確認
- [x] フル機能版動作確認
- [x] 10+統合テスト（全パス）
- [x] ドキュメント完成
- [x] CHANGELOG更新
- [x] v2.3.0リリース準備完了

---

## 🎬 理想的な最終UX

```bash
$ kagura chat --full --dir ./project
Scanning directory...
  - 15 PDF files
  - 42 images
  - 3 audio files
Building vector index... Done! (234 files indexed)

> この設計書（PDF）の問題点を、最新のベストプラクティスと比較して

AI: 設計書を読み込んでいます...
    [PDF: 15ページ解析完了]
    Web検索中: "2025 system design best practices"
    [5件の記事を参照]
    プロジェクトの過去の会話を検索中...
    [3件の関連ディスカッション発見]

    分析結果:
    1. アーキテクチャ図（3ページ目）では...
    2. 最新トレンド（参考: Martin Fowler 2025）によれば...
    3. プロジェクト内の過去の議論では...

> もっと詳しく教えて

AI: （会話履歴を理解して継続）
    先ほどの指摘について、さらに詳しく...
```

---

## 📊 完了目標

**完了するRFC**: 2個（RFC-002コア、RFC-014）
**新規実装**: 10+ファイル
**新規テスト**: 74+テスト（90%+カバレッジ）
**ドキュメント**: 3+チュートリアル

---

## 🔄 スコープ調整

### v2.3.0で実装 ✅
- ✅ Geminiマルチモーダル対応（画像・音声・動画・PDF）
- ✅ ChromaDBベクトル検索
- ✅ Web検索・スクレイピング
- ✅ `kagura chat`統合

### v2.4.0に延期 ⏭️
- ❌ Google Workspace連携（Drive/Calendar/Gmail）
- ❌ MCP互換レイヤー
- ❌ RFC-007 Phase 2（MCP Memory Protocol）
- ❌ RFC-013（OAuth2 Authentication）

---

## 📚 関連ドキュメント

- [RFC-002: Multimodal RAG](./rfcs/RFC_002_MULTIMODAL_RAG.md)
- [RFC-014: Web Integration](./rfcs/RFC_014_WEB_INTEGRATION.md)
- [UNIFIED_ROADMAP.md](./UNIFIED_ROADMAP.md) - 全体ロードマップ
- [NEXT_STEPS.md](./NEXT_STEPS.md) - 次のアクション

---

## 🎯 次のアクション

**今すぐ開始**: Issue [#121](https://github.com/JFK/kagura-ai/issues/121)（Week 1: Gemini API統合）

**v2.2.0完了から次のステップへ！🚀**
