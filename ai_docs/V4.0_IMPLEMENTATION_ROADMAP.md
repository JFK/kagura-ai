# Kagura AI v4.0 - Implementation Roadmap

**日付**: 2025-10-25 (更新: 2025-10-26)
**期間**: 8-12 months (v4.0.0 → v4.2.0)
**スタイル**: Agile, Issue-driven Development

---

## 📋 Overview

このロードマップは、Kagura AIをv3.0（Python SDK + Chat）から**v4.0（Universal AI Memory Platform）**へ移行するための実装計画です。

**Goal**:
> Make Kagura the **de facto standard** for AI Memory & Context Management across all platforms via MCP.

---

## 🗓️ Release Timeline

```
2025-10 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 2026-06
   │                                                              │
   v4.0.0a0 ──▶ v4.0.0 ────────▶ v4.1.0 ────────▶ v4.2.0
   (✅ Oct 26)  (Q1 2026)         (Q2 2026)        (Q3-Q4 2026)

   Phase A/B     Phase C          Phase D-F        Phase G-H
   ✅ Complete   Remote MCP       Multimodal      Cloud SaaS
                 + Consolidation   MVP
```

**Legend**:
- ✅: 完了
- 進行中: Phase C準備
- Phase: 開発フェーズ

---

## ✅ Phase A: MCP-First Foundation (v4.0.0a0) - COMPLETE

**期間**: Week 1-4 (Oct 2025)
**Status**: ✅ **Complete** (Released 2025-10-26)
**Target Release**: v4.0.0a0 ✅

### Week 1: Core Refactoring

#### Task 1.1: Repository Restructure
**Issue**: [#XXX] Refactor for Memory-First Architecture

```bash
# New structure
kagura-ai/
├── src/kagura/
│   ├── core/
│   │   ├── memory/          # Memory Manager (existing)
│   │   ├── graph/           # GraphMemory (new, Phase B)
│   │   └── rag/             # RAG (existing)
│   ├── api/                 # 🆕 REST API Server
│   │   ├── server.py        # FastAPI app
│   │   ├── routes/          # API routes
│   │   └── models.py        # Pydantic models
│   ├── mcp/
│   │   ├── server.py        # MCP server (existing)
│   │   ├── tools/           # MCP tools
│   │   └── config.py        # MCP config (from #331)
│   ├── cli/
│   │   ├── mcp.py           # kagura mcp commands
│   │   └── chat.py          # Minimal chat (test only)
│   └── tools/               # Optional tools (web, youtube等)
├── tests/
├── docker/                  # 🆕 Docker configs
│   ├── docker-compose.yml   # Local deployment
│   └── Dockerfile
├── docs/
└── examples/
```

**Deliverables**:
- [ ] New directory structure
- [ ] Migration guide from v3.0
- [ ] Tests passing

**Estimate**: 3-5 days

---

#### Task 1.2: Memory API Server (FastAPI)
**Issue**: [#XXX] Implement REST API for Memory Management

**Spec**:
```python
# src/kagura/api/server.py
from fastapi import FastAPI, Depends, HTTPException
from pydantic import BaseModel

app = FastAPI(title="Kagura Memory API", version="4.0.0")

# Memory CRUD
@app.post("/api/v1/memory")
async def create_memory(...): ...

@app.get("/api/v1/memory/{key}")
async def get_memory(...): ...

@app.put("/api/v1/memory/{key}")
async def update_memory(...): ...

@app.delete("/api/v1/memory/{key}")
async def delete_memory(...): ...

# Search
@app.get("/api/v1/memory/search")
async def search_memory(...): ...

# Graph (Phase B)
@app.get("/api/v1/memory/{key}/related")
async def get_related(...): ...

@app.get("/api/v1/graph")
async def get_full_graph(): ...

# System
@app.get("/api/v1/health")
async def health_check(): ...

@app.get("/api/v1/metrics")
async def get_metrics(): ...
```

**Authentication**:
- Local: None（localhost限定）
- Self-hosted: API Key（Phase C）
- Cloud: OAuth2 + JWT（Phase E）

**Deliverables**:
- [ ] FastAPI server implementation
- [ ] OpenAPI documentation (`/docs`)
- [ ] Tests（unit + integration）
- [ ] Docker support

**Estimate**: 5-7 days

---

### Week 2-3: MCP Tools v1.0

#### Task 2.1: MCP Tools Implementation
**Issue**: [#XXX] Implement MCP Tools v1.0 Contract

**Tools to Implement**:
```python
# memory.store
{
  "name": "memory_store",
  "description": "Store a memory with metadata",
  "inputSchema": {
    "type": "object",
    "properties": {
      "text": {"type": "string"},
      "kind": {"type": "string", "enum": ["note", "code", "conversation", "document"]},
      "source": {"type": "string"},
      "scope": {"type": "string", "enum": ["working", "persistent"], "default": "working"},
      "tags": {"type": "array", "items": {"type": "string"}},
      "importance": {"type": "number", "minimum": 0, "maximum": 1}
    },
    "required": ["text"]
  }
}

# memory.recall
{
  "name": "memory_recall",
  "description": "Recall memories by semantic similarity",
  "inputSchema": {
    "type": "object",
    "properties": {
      "query": {"type": "string"},
      "k": {"type": "integer", "default": 5},
      "scope": {"type": "string", "enum": ["working", "persistent", "all"], "default": "all"},
      "include_graph": {"type": "boolean", "default": false}
    },
    "required": ["query"]
  }
}

# memory.search
{
  "name": "memory_search",
  "description": "Full-text + semantic search",
  "inputSchema": {
    "type": "object",
    "properties": {
      "query": {"type": "string"},
      "filter": {"type": "object"},
      "limit": {"type": "integer", "default": 10}
    },
    "required": ["query"]
  }
}

# memory.feedback
{
  "name": "memory_feedback",
  "description": "Provide feedback on memory usefulness",
  "inputSchema": {
    "type": "object",
    "properties": {
      "node_id": {"type": "string"},
      "label": {"type": "string", "enum": ["useful", "irrelevant", "outdated"]},
      "weight": {"type": "number", "minimum": -1, "maximum": 1}
    },
    "required": ["node_id", "label"]
  }
}

# memory.delete
{
  "name": "memory_delete",
  "description": "Delete a memory (with audit log)",
  "inputSchema": {
    "type": "object",
    "properties": {
      "node_id": {"type": "string"}
    },
    "required": ["node_id"]
  }
}

# memory.export / memory.import (Phase C)
# memory.link / memory.query_graph (Phase B)
# memory.record_interaction (Phase B)
```

**Deliverables**:
- [ ] 5 core MCP tools implemented
- [ ] MCP server updated
- [ ] Tests (MCP protocol compliance)
- [ ] Documentation

**Estimate**: 7-10 days

---

#### Task 2.2: MCP Tool Management (#331 Integration)
**Issue**: [#331] MCP Enhancement - Tool Management

**Features**:
```bash
# Tool management
kagura mcp tools                    # List all tools
kagura mcp enable memory_store      # Enable specific tool
kagura mcp disable memory_search    # Disable specific tool
kagura mcp test memory_recall       # Test tool

# Diagnostics
kagura mcp doctor                   # Health check
# Output:
# ✅ MCP Server: Running
# ✅ API Server: Running (http://localhost:8080)
# ✅ Memory: 150 nodes, 87 edges
# ⚠️  Storage: 85% full
# ❌ ChromaDB: Not initialized
#    Fix: kagura init --rag

# Claude Desktop integration
kagura mcp install                  # Auto-configure Claude Desktop
kagura mcp uninstall                # Remove configuration
```

**Deliverables**:
- [ ] CLI commands implementation
- [ ] `~/.kagura/mcp-config.yaml` support
- [ ] Claude Desktop auto-configuration
- [ ] `kagura mcp doctor` diagnostics
- [ ] Tests

**Estimate**: 5-7 days

---

### Week 4: Documentation & Alpha Release

#### Task 4.1: Documentation Rewrite
**Issue**: [#XXX] Rewrite Documentation for v4.0

**Files to Update**:
- [ ] `README.md` - New positioning（v4.0_README_DRAFT.mdベース）
- [ ] `docs/getting-started.md` - Quickstart guide
- [ ] `docs/api-reference.md` - REST API + MCP tools
- [ ] `docs/mcp-setup.md` - Claude Desktop integration
- [ ] `docs/architecture.md` - System architecture
- [ ] `docs/migration-v3-to-v4.md` - Migration guide

**Deliverables**:
- [ ] All docs updated
- [ ] Examples updated
- [ ] API documentation (OpenAPI)

**Estimate**: 5-7 days

---

#### Task 4.2: Alpha Release
**Issue**: [#XXX] Release v4.0.0a

**Checklist**:
- [ ] All Phase A tasks completed
- [ ] Tests passing (>90% coverage)
- [ ] Documentation complete
- [ ] Docker Compose working
- [ ] MCP tools functional
- [ ] API server functional
- [ ] Tag v4.0.0a
- [ ] PyPI release（alpha channel）

**Announcement**:
- [ ] GitHub Release notes
- [ ] Blog post（Medium/Dev.to）
- [ ] Community preview（select users）

**Estimate**: 2-3 days

---

## ✅ Phase B: GraphMemory & User Pattern Analysis - COMPLETE

**期間**: Week 5-12 (Oct 2025)
**Status**: ✅ **Complete** (Released 2025-10-26 with v4.0.0a0)
**Target Release**: v4.0.0a0 ✅
**Issue**: [#345](https://github.com/JFK/kagura-ai/issues/345)

### Week 5-7: GraphMemory Implementation (#345)

#### Task 5.1: GraphMemory Core
**Issue**: [#345] GraphDB Integration for AI-User Relationship Memory

**Implementation**:
```python
# src/kagura/core/graph/memory.py
import networkx as nx
from typing import Optional

class GraphMemory:
    """NetworkX-based graph memory for relationships"""

    def __init__(self, persist_path: Optional[str] = None):
        self.graph = nx.DiGraph()
        self.persist_path = persist_path

    # Node types
    NODE_TYPES = ["user", "topic", "memory", "interaction"]

    # Edge types
    EDGE_TYPES = [
        "related_to",
        "depends_on",
        "learned_from",
        "influences",
        "works_on"
    ]

    async def add_node(self, node_id: str, node_type: str, data: dict):
        """Add node to graph"""
        self.graph.add_node(node_id, type=node_type, **data)

    async def add_edge(
        self,
        src_id: str,
        dst_id: str,
        rel_type: str,
        weight: float = 1.0
    ):
        """Add edge between nodes"""
        self.graph.add_edge(src_id, dst_id, type=rel_type, weight=weight)

    async def query_graph(
        self,
        seed_ids: list[str],
        hops: int = 2,
        rel_filters: Optional[list[str]] = None
    ) -> dict:
        """Multi-hop graph traversal"""
        subgraph = self._traverse(seed_ids, hops, rel_filters)
        return self._serialize_subgraph(subgraph)

    async def get_related(
        self,
        node_id: str,
        depth: int = 2
    ) -> list[dict]:
        """Get related nodes by traversal"""
        ...

    async def record_interaction(
        self,
        user_id: str,
        ai_platform: str,
        query: str,
        response: str,
        meta: dict
    ):
        """Record AI-User interaction"""
        interaction_id = f"int_{timestamp}_{uuid}"
        await self.add_node(interaction_id, "interaction", {
            "user_id": user_id,
            "ai_platform": ai_platform,
            "query": query,
            "response": response,
            "timestamp": meta["timestamp"],
            **meta
        })
        # Link to user, topics, memories
        ...

    async def persist(self):
        """Save graph to disk (pickle)"""
        import pickle
        with open(self.persist_path, "wb") as f:
            pickle.dump(self.graph, f)

    async def load(self):
        """Load graph from disk"""
        import pickle
        with open(self.persist_path, "rb") as f:
            self.graph = pickle.load(f)
```

**Deliverables**:
- [ ] GraphMemory class
- [ ] Node/Edge management
- [ ] Graph traversal
- [ ] Persistence (pickle)
- [ ] Tests

**Estimate**: 10-12 days

---

#### Task 5.2: MemoryManager Integration
**Issue**: [#XXX] Integrate GraphMemory into MemoryManager

```python
# src/kagura/core/memory/manager.py
from kagura.core.graph.memory import GraphMemory

class MemoryManager:
    def __init__(self, ..., enable_graph: bool = True):
        self.working = WorkingMemory()
        self.context = ContextMemory()
        self.persistent = PersistentMemory()
        self.rag = MemoryRAG()
        self.persistent_rag = MemoryRAG()  # #340
        self.graph = GraphMemory() if enable_graph else None  # 🆕

    async def store(self, key: str, value: str, scope: str = "working"):
        # Existing logic
        ...

        # Add to graph
        if self.graph:
            await self.graph.add_node(
                node_id=f"{scope}:{key}",
                node_type="memory",
                data={"key": key, "value": value, "scope": scope}
            )
```

**Deliverables**:
- [ ] GraphMemory integration
- [ ] Backward compatibility（`enable_graph=False`）
- [ ] Tests

**Estimate**: 3-5 days

---

#### Task 5.3: MCP Tools for Graph
**Issue**: [#XXX] Add Graph Operations to MCP Tools

```python
# memory.link
{
  "name": "memory_link",
  "description": "Create relationship between memories",
  "inputSchema": {
    "type": "object",
    "properties": {
      "src_id": {"type": "string"},
      "dst_id": {"type": "string"},
      "rel_type": {"type": "string", "enum": ["related_to", "depends_on", ...]},
      "weight": {"type": "number", "default": 1.0}
    },
    "required": ["src_id", "dst_id", "rel_type"]
  }
}

# memory.query_graph
{
  "name": "memory_query_graph",
  "description": "Multi-hop graph traversal",
  "inputSchema": {
    "type": "object",
    "properties": {
      "seed_ids": {"type": "array", "items": {"type": "string"}},
      "hops": {"type": "integer", "default": 2},
      "rel_filters": {"type": "array", "items": {"type": "string"}}
    },
    "required": ["seed_ids"]
  }
}

# memory.record_interaction
{
  "name": "memory_record_interaction",
  "description": "Record AI-User interaction for Vibe Coding history",
  "inputSchema": {
    "type": "object",
    "properties": {
      "ai_platform": {"type": "string"},
      "query": {"type": "string"},
      "response": {"type": "string"},
      "meta": {"type": "object"}
    },
    "required": ["ai_platform", "query", "response"]
  }
}
```

**Deliverables**:
- [ ] 3 new MCP tools
- [ ] Tests
- [ ] Documentation

**Estimate**: 5-7 days

---

### Week 8-10: Consolidation & Export

#### Task 8.1: Memory Consolidation
**Issue**: [#XXX] Implement Memory Consolidation (Short → Long-term)

**Features**:
- Short-term → Long-term migration
- Summarization（重複情報の統合）
- Importance scoring（Hebbian-like）
- Deduplication

**Implementation**:
```python
# src/kagura/core/memory/consolidation.py
from kagura.core.memory import MemoryManager

class MemoryConsolidator:
    async def consolidate(
        self,
        manager: MemoryManager,
        strategy: str = "auto"
    ):
        """Consolidate memories from working to persistent"""
        # 1. Identify candidates (age, importance)
        candidates = await self._identify_candidates(manager.working)

        # 2. Summarize duplicates
        consolidated = await self._summarize_duplicates(candidates)

        # 3. Update importance scores
        scored = await self._update_importance(consolidated)

        # 4. Migrate to persistent
        for memory in scored:
            await manager.persistent.store(memory.key, memory.value)
            await manager.working.delete(memory.key)

        # 5. Update graph weights
        if manager.graph:
            await manager.graph.update_weights()
```

**Deliverables**:
- [ ] Consolidation logic
- [ ] CLI command: `kagura memory consolidate`
- [ ] Scheduled job support（cron/systemd）
- [ ] Tests

**Estimate**: 7-10 days

---

#### Task 8.2: Export/Import
**Issue**: [#XXX] Implement Complete Data Export/Import

**Format (JSONL)**:
```jsonl
{"type": "memory", "id": "mem_001", "key": "...", "value": "...", "scope": "persistent", "tags": ["python"], "created_at": "2025-10-25T12:00:00Z"}
{"type": "edge", "src": "mem_001", "dst": "mem_002", "rel_type": "related_to", "weight": 0.8}
{"type": "interaction", "id": "int_001", "user_id": "user_1", "ai_platform": "claude", "query": "...", "response": "...", "timestamp": "..."}
```

**Attachments**:
```
export/
├── memories.jsonl
├── graph.jsonl
├── interactions.jsonl
└── attachments/
    ├── file_001.pdf
    └── image_002.png
```

**Implementation**:
```python
# src/kagura/core/memory/export.py
async def export_all(output_dir: str):
    """Export all memories, graph, interactions"""
    ...

async def import_all(input_dir: str):
    """Import from exported data"""
    ...
```

**Deliverables**:
- [ ] Export logic
- [ ] Import logic
- [ ] CLI commands: `kagura memory export/import`
- [ ] Tests（roundtrip）

**Estimate**: 5-7 days

---

### Week 11-12: Testing & Stable Release

#### Task 11.1: Integration Testing
**Issue**: [#XXX] Comprehensive Integration Tests for v4.0

**Test Scenarios**:
- [ ] MCP client → MCP server → API → Storage
- [ ] Memory CRUD via MCP
- [ ] Graph operations via MCP
- [ ] Consolidation process
- [ ] Export/Import roundtrip
- [ ] Multiple clients concurrently

**Deliverables**:
- [ ] Integration test suite
- [ ] Performance benchmarks
- [ ] Load testing

**Estimate**: 5-7 days

---

#### Task 11.2: v4.0.0 Stable Release
**Issue**: [#XXX] Release v4.0.0 (Stable)

**Checklist**:
- [ ] All Phase B tasks completed
- [ ] Tests passing (>90% coverage)
- [ ] Documentation updated
- [ ] Performance benchmarks published
- [ ] Migration guide finalized
- [ ] Tag v4.0.0
- [ ] PyPI release（stable）

**Launch**:
- [ ] GitHub Release
- [ ] Hacker News - "Show HN: Kagura - Universal Memory Layer for AI (MCP-native)"
- [ ] Reddit posts（r/LLMs, r/ClaudeAI）
- [ ] Blog post（announcement）
- [ ] Product Hunt（optional）

**Estimate**: 3-5 days

---

## 🚀 Phase C: Remote MCP Server + Consolidation (v4.0.0 stable)

**期間**: Late Nov 2025 - Q1 2026 (4 weeks)
**Status**: 🔄 **準備中** (Cleanup: Issues #373-376)
**Target Release**: v4.0.0 stable
**Issue**: [#378](https://github.com/JFK/kagura-ai/issues/378)

**Goal**:
1. **Remote MCP Server** (#368) - Network-accessible MCP tools
2. **Memory Consolidation** - Export/Import, lifecycle management

---

### Overview

Phase Cでは、v4.0.0a0を安定版v4.0.0にするために以下を実装：

**1. Remote MCP Server** (Issue #368):
- Approach: **Option 2 (Hybrid)** - Local MCP Connector + Remote REST API
- Local connector: stdio ↔ HTTP bridge
- API authentication: API Key
- Tool access control: local-only filtering
- Production Docker setup

**2. Memory Consolidation**:
- Short-term → Long-term migration
- Export/Import (JSONL format)
- Summarization & deduplication
- GDPR-compliant deletion

---

### Implementation Tasks

詳細は Issue #378 を参照

**Week 1-2**: Remote MCP Server
- MCP Connector implementation
- API Key authentication
- Tool access control
- CLI commands (\`kagura mcp connect\`, \`kagura mcp serve --remote\`)

**Week 3**: Memory Consolidation
- Lifecycle management
- Export/Import (JSONL)
- Deletion audit logs

**Week 4**: Testing & Documentation
- Integration testing
- Docker production setup
- Documentation
- v4.0.0 stable release

---

## 🌐 Phase D-F: Self-hosted API + Multimodal MVP + Consumer App (v4.1.0)

**期間**: Q2 2026 (3 months)
**Goal**: Self-hosted API、Connectors実装
**Target Release**: v4.1.0

### Week 13-15: Self-hosted API

#### Task 13.1: Authentication & Authorization
**Issue**: [#XXX] Implement API Authentication

**Features**:
- API Key management
- OAuth2 support（optional）
- Rate limiting
- CORS configuration

**Implementation**:
```python
# src/kagura/api/auth.py
from fastapi import Depends, HTTPException
from fastapi.security import APIKeyHeader

api_key_header = APIKeyHeader(name="X-API-Key")

async def verify_api_key(api_key: str = Depends(api_key_header)):
    if not validate_api_key(api_key):
        raise HTTPException(status_code=403, detail="Invalid API key")
    return api_key
```

**Deliverables**:
- [ ] API Key management
- [ ] CLI: `kagura api-key create/list/revoke`
- [ ] Rate limiting
- [ ] Tests

**Estimate**: 5-7 days

---

#### Task 13.2: Production Deployment
**Issue**: [#XXX] Production-ready Docker Compose

**Features**:
- PostgreSQL + pgvector
- Redis（job queue）
- Nginx（reverse proxy）
- Let's Encrypt SSL
- Monitoring（Prometheus/Grafana）

**docker-compose.prod.yml**:
```yaml
services:
  postgres:
    image: pgvector/pgvector:pg16
    environment:
      POSTGRES_DB: kagura
      POSTGRES_USER: kagura
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

  api:
    build: .
    environment:
      DATABASE_URL: postgres://kagura:${DB_PASSWORD}@postgres/kagura
      REDIS_URL: redis://redis:6379
    depends_on:
      - postgres
      - redis

  nginx:
    image: nginx:alpine
    ports:
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/ssl
```

**Deliverables**:
- [ ] Production Docker Compose
- [ ] Deployment guide
- [ ] Backup/Restore scripts
- [ ] Monitoring dashboard

**Estimate**: 7-10 days

---

### Week 16-18: Connectors

#### Task 16.1: GitHub Connector
**Issue**: [#XXX] GitHub Connector for Codebase Indexing

**Features**:
- Repository indexing
- Commit history tracking
- PR/Issue indexing
- Selective sync（branches, date range）

**Implementation**:
```python
# src/kagura/connectors/github.py
from github import Github

class GitHubConnector:
    async def index_repository(
        self,
        repo_url: str,
        branches: list[str] = ["main"],
        since: Optional[datetime] = None
    ):
        """Index GitHub repository"""
        # 1. Clone or fetch
        # 2. Extract code, commits, PRs
        # 3. Store in memory + RAG
        # 4. Build graph（files → dependencies）
        ...
```

**Deliverables**:
- [ ] GitHub connector
- [ ] CLI: `kagura connect github <repo_url>`
- [ ] Selective sync settings
- [ ] Tests

**Estimate**: 7-10 days

---

#### Task 16.2: Calendar & Files Connectors
**Issue**: [#XXX] Calendar & Files Connectors

**Calendar**:
- Google Calendar API
- Event indexing
- Meeting notes association

**Files**:
- Local file indexing
- Watch mode（inotify）
- Supported formats: .txt, .md, .pdf, .docx

**Deliverables**:
- [ ] Calendar connector
- [ ] Files connector
- [ ] CLI commands
- [ ] Tests

**Estimate**: 5-7 days

---

### Week 19-20: v4.1.0 Release

#### Task 19.1: Testing & Documentation
**Issue**: [#XXX] v4.1 Testing & Documentation

**Testing**:
- [ ] Self-hosted deployment tests
- [ ] Multi-user tests
- [ ] Connector tests

**Documentation**:
- [ ] Self-hosted deployment guide
- [ ] Connector setup guides
- [ ] API authentication guide

**Estimate**: 5-7 days

---

#### Task 19.2: v4.1.0 Release
**Issue**: [#XXX] Release v4.1.0

**Launch**:
- [ ] GitHub Release
- [ ] Blog post（self-hosted focus）
- [ ] Community showcase（デモ動画）

**Estimate**: 2-3 days

---

## 📱 Phase D: Consumer App (v4.1.x)

**期間**: Week 13-24 (3 months, parallel with Phase C)
**Goal**: Flutter app開発・公開
**Target Release**: v4.1.5

### Week 13-16: Flutter App Development

#### Task 13.1: App Architecture
**Issue**: [#XXX] Flutter App Architecture

**Structure**:
```
kagura-app/
├── lib/
│   ├── main.dart
│   ├── models/
│   │   ├── memory.dart
│   │   ├── graph_node.dart
│   │   └── insight.dart
│   ├── services/
│   │   ├── api_client.dart       # Kagura API client
│   │   └── auth_service.dart     # Authentication
│   ├── providers/
│   │   ├── memory_provider.dart  # State management (Riverpod)
│   │   └── graph_provider.dart
│   ├── screens/
│   │   ├── home_screen.dart
│   │   ├── memory_browser.dart
│   │   ├── graph_viewer.dart
│   │   ├── search_screen.dart
│   │   └── settings_screen.dart
│   └── widgets/
│       ├── memory_card.dart
│       └── graph_widget.dart
├── test/
├── ios/
├── android/
├── macos/
├── windows/
└── linux/
```

**Deliverables**:
- [ ] App architecture design
- [ ] Navigation structure
- [ ] State management setup

**Estimate**: 3-5 days

---

#### Task 14.1: Core Features Implementation
**Issue**: [#XXX] Implement Core App Features

**Features**:
- [ ] Memory Browser（カード形式）
- [ ] Search（フルテキスト + セマンティック）
- [ ] Memory detail view
- [ ] Manual add/edit/delete
- [ ] Tags management
- [ ] Settings（API endpoint, theme）

**Deliverables**:
- [ ] Core screens implementation
- [ ] API integration
- [ ] Tests

**Estimate**: 15-20 days

---

#### Task 15.1: Graph Viewer
**Issue**: [#XXX] Implement Graph Visualization

**Library**: flutter_force_directed_graph or custom D3.js wrapper

**Features**:
- [ ] Interactive graph view
- [ ] Node filtering（by type, tag）
- [ ] Edge highlighting
- [ ] Node details on tap
- [ ] Zoom/Pan

**Deliverables**:
- [ ] Graph viewer screen
- [ ] Graph rendering logic
- [ ] Tests

**Estimate**: 7-10 days

---

### Week 17-20: Insights & Polish

#### Task 17.1: Insights Dashboard
**Issue**: [#XXX] Implement Insights & Analytics

**Features**:
- [ ] Memory statistics（total, by scope, by tag）
- [ ] Interaction history（AI platforms used, frequency）
- [ ] Learning patterns（topics over time）
- [ ] Vibe Coding insights（coding sessions, patterns）

**Deliverables**:
- [ ] Insights screen
- [ ] Charts（fl_chart library）
- [ ] Tests

**Estimate**: 7-10 days

---

#### Task 18.1: UI/UX Polish
**Issue**: [#XXX] UI/UX Polish & Testing

**Tasks**:
- [ ] UI refinement（Material Design 3）
- [ ] Dark mode
- [ ] Animations
- [ ] Accessibility
- [ ] Localization（英語・日本語）

**Deliverables**:
- [ ] Polished UI
- [ ] Accessibility compliance
- [ ] Localization files

**Estimate**: 7-10 days

---

### Week 21-24: App Release

#### Task 21.1: Platform Builds
**Issue**: [#XXX] Build for All Platforms

**Platforms**:
- [ ] iOS（App Store）
- [ ] Android（Google Play）
- [ ] macOS（App Store / Direct download）
- [ ] Windows（Microsoft Store / Direct download）
- [ ] Linux（Snap / AppImage）

**Deliverables**:
- [ ] Platform-specific builds
- [ ] Signing certificates
- [ ] Store listings

**Estimate**: 5-7 days

---

#### Task 22.1: App Store Submission
**Issue**: [#XXX] Submit to App Stores

**Tasks**:
- [ ] iOS App Store submission
- [ ] Google Play submission
- [ ] Screenshots, descriptions
- [ ] Privacy policy
- [ ] Terms of service

**Deliverables**:
- [ ] Published apps
- [ ] App Store Optimization

**Estimate**: 5-7 days（including review time）

---

#### Task 23.1: Launch Campaign
**Issue**: [#XXX] App Launch Campaign

**Channels**:
- [ ] Product Hunt launch
- [ ] Blog post（app focus）
- [ ] Twitter/X announcement
- [ ] YouTube demo video
- [ ] Reddit posts

**Deliverables**:
- [ ] Marketing materials
- [ ] Launch posts
- [ ] Demo video

**Estimate**: 3-5 days

---

## ☁️ Phase E: Cloud & Enterprise (v4.2.0)

**期間**: Week 25-48 (6 months)
**Goal**: Cloud SaaS、エンタープライズ機能
**Target Release**: v4.2.0

### Weeks 25-48: Cloud Infrastructure & Enterprise Features

#### Major Tasks
- [ ] Multi-tenant architecture
- [ ] Row-Level Security (RLS)
- [ ] BYOK (Bring Your Own Key)
- [ ] SSO (SAML, OIDC)
- [ ] Audit logs
- [ ] Team collaboration
- [ ] Billing system
- [ ] Admin dashboard
- [ ] Compliance（GDPR, SOC2）

**Note**: 詳細は別ドキュメント`V4.2_CLOUD_ROADMAP.md`を参照

---

## 📦 提供される実装ピース（ChatGPT 5 Pro）

### 利用可能なzipファイル

ユーザーが手元に持っている実装コード：

1. **nmn_poc_v02.zip**
   - Memory API v0.2（pgvector + Redis/RQ + FastAPI + OpenAPI）
   - 即座に使える実装

2. **nmn_poc_v01.zip**
   - 最小版 v0.1（インメモリ）
   - プロトタイプ

3. **nmn_mcp_tools.zip**
   - MCPツールサーバ（最小 / RESTプロキシ）
   - recall/feedback/forget 実装済み

4. **nmn_bench.zip**
   - ベンチマークスイート（pgvector / FAISS vs NumPy）

### 活用方法

#### Phase A (Week 1-2): API Server
```bash
# nmn_poc_v02.zip を解凍
unzip nmn_poc_v02.zip -d /tmp/nmn_poc
cd /tmp/nmn_poc

# Kaguraリポジトリにマージ
cp -r nmn_poc/api/* /home/jfk/works/kagura-ai/src/kagura/api/

# Adapt to Kagura structure
# - Rename modules
# - Update imports
# - Integrate with MemoryManager
```

#### Phase A (Week 2-3): MCP Tools
```bash
# nmn_mcp_tools.zip を解凍
unzip nmn_mcp_tools.zip -d /tmp/nmn_mcp
cd /tmp/nmn_mcp

# Add to Kagura MCP server
cp nmn_mcp/tools/* /home/jfk/works/kagura-ai/src/kagura/mcp/tools/

# Extend with memory.store, memory.search
```

#### Phase B (Week 5-7): Benchmarks
```bash
# nmn_bench.zip を解凍
unzip nmn_bench.zip -d /tmp/nmn_bench

# Use for performance testing
python nmn_bench/benchmark.py --vector-db=chromadb --n-nodes=10000
```

---

## 📊 KPIs & Success Metrics

### Technical Metrics

| Metric | v4.0 Target | v4.1 Target | v4.2 Target |
|--------|-------------|-------------|-------------|
| **Setup Time** | 10 min | 5 min | 1 min (Cloud) |
| **Recall@5** | 0.85+ | 0.90+ | 0.95+ |
| **p95 Latency** | < 100ms | < 50ms | < 30ms |
| **Export Success** | 99%+ | 99.9%+ | 99.99%+ |
| **Test Coverage** | 90%+ | 92%+ | 95%+ |

### User Metrics

| Metric | v4.0 Target | v4.1 Target | v4.2 Target |
|--------|-------------|-------------|-------------|
| **MAU** | 500 | 5,000 | 50,000 |
| **GitHub Stars** | 1,000 | 5,000 | 10,000+ |
| **App Downloads** | - | 10,000 | 100,000 |
| **NPS** | 40+ | 50+ | 60+ |

### Business Metrics (v4.1+)

| Metric | v4.1 Target | v4.2 Target |
|--------|-------------|-------------|
| **Paying Users** | 100 | 1,000 |
| **MRR** | $1,000 | $10,000 |
| **Churn Rate** | < 10% | < 5% |
| **CAC** | < $50 | < $30 |

---

## 🔗 Related Documents

- [V4.0_STRATEGIC_PIVOT.md](./V4.0_STRATEGIC_PIVOT.md) - 戦略概要
- [V4.0_COMPETITIVE_ANALYSIS.md](./V4.0_COMPETITIVE_ANALYSIS.md) - 競合分析
- [V4.0_README_DRAFT.md](./V4.0_README_DRAFT.md) - 新README草案
- [V4.0_GITHUB_ISSUE_TEMPLATE.md](./V4.0_GITHUB_ISSUE_TEMPLATE.md) - Issue作成用

**既存Issue参照**:
- [#331: MCP Enhancement Roadmap](https://github.com/JFK/kagura-ai/issues/331)
- [#345: GraphDB Memory Integration](https://github.com/JFK/kagura-ai/issues/345)

---

## 📝 Update History

| Date | Update | Phase | Author |
|------|--------|-------|--------|
| 2025-10-25 | Initial roadmap | All | Claude Code |

---

**Status**: 📋 Draft (Awaiting Community Feedback)
**Owner**: @jfk
**Next Review**: Weekly during active development
