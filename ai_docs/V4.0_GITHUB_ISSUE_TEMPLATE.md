# GitHub Issue Template: v4.0 Strategic Pivot

このファイルの内容をそのままGitHub Issueに投稿できます。

---

**Title**:
```
[RFC] Kagura v4.0: Strategic Pivot to Universal AI Memory Platform
```

**Labels**: `rfc`, `v4.0`, `strategic`, `discussion`

**Body**:

---

## 📋 Summary

This RFC proposes a **strategic pivot** for Kagura AI from **Python SDK + Chat** (v3.0) to **Universal AI Memory & Context Platform** (v4.0).

**Core Change**:
> Kagura becomes a **memory layer** that all AI platforms (Claude, ChatGPT, Gemini, etc.) can access via MCP, rather than a standalone SDK/Chat tool.

**Tagline**:
> **Own your memory. Bring it to every AI.**

---

## 🎯 Motivation

### Current State (v3.0)
- **SDK**: Python-first agent framework with `@agent` decorator
- **Chat**: Interactive CLI (bonus feature)
- **Position**: Developer tool for building AI agents

### Problems
1. **Context fragmentation**: Users lose memory when switching AI platforms
2. **Vendor lock-in**: Each platform has its own memory system
3. **Limited adoption**: SDK requires coding; Chat is niche

### Opportunity
- **MCP adoption**: OpenAI, Google confirmed support（2025）
- **Market need**: Users want **portable** memory across platforms
- **Competition**: Mem0 announced MCP support, but lacks full OSS + local-first

---

## 💡 Proposed Solution

### v4.0: Universal AI Memory Platform

```
┌─────────────────────────────────────────┐
│  AI Platforms (via MCP)                 │
│  Claude, ChatGPT, Gemini, Cursor, ...   │
└─────────────────────────────────────────┘
         ↕ MCP Protocol
┌─────────────────────────────────────────┐
│  Kagura Memory Hub (Core)               │
│  - Memory Manager (3-tier + Graph)      │
│  - RAG (Knowledge Base)                 │
│  - History Tracker (Vibe Coding)        │
│  - API Server (REST)                    │
└─────────────────────────────────────────┘
         ↕ Storage
┌─────────────────────────────────────────┐
│  SQLite + ChromaDB + NetworkX           │
│  pgvector (Cloud/Self-hosted)           │
└─────────────────────────────────────────┘
```

**Key Features**:
- **MCP-native**: Primary interface via Model Context Protocol
- **Memory-first**: Core value is memory/context management
- **Multi-deployment**: Local / Self-hosted / Cloud（future）
- **Data portability**: Complete export/import（JSONL）

---

## 🏗️ Architecture Changes

### What Stays
- ✅ Core memory system（3-tier: working/context/persistent）
- ✅ RAG with ChromaDB
- ✅ MCP server（enhanced）
- ✅ CLI tools（refocused）

### What Changes
- 🔄 **Chat → Minimal**（MCP testing only）
- 🔄 **SDK → Optional**（for advanced users）
- 🔄 **Personal tools → Removed**（news, weather, recipes）
- 🔄 **README → Memory-first positioning**

### What's New
- 🆕 **REST API**（FastAPI）for Consumer App
- 🆕 **GraphMemory**（NetworkX - see #345）
- 🆕 **Consolidation**（Short-term → Long-term）
- 🆕 **Export/Import**（JSONL + attachments）
- 🆕 **Consumer App**（Flutter - iOS/Android/Desktop）
- 🆕 **Connectors**（GitHub, Calendar, Files）

---

## 🔌 MCP Tools v1.0

Proposed MCP tools contract:

```python
# Core Memory
memory_store(text, kind, source, scope, tags, importance)
memory_recall(query, k, scope, include_graph)
memory_search(query, filter, limit)
memory_feedback(node_id, label, weight)
memory_delete(node_id)

# Graph Operations (#345)
memory_link(src_id, dst_id, rel_type, weight)
memory_query_graph(seed_ids, hops, rel_filters)
memory_record_interaction(ai_platform, query, response, meta)

# System
memory_metrics()
memory_export()
memory_import()
```

**Integration with #331**: MCP Enhancement Roadmap
- Tool management（`kagura mcp tools`, `enable/disable`）
- Claude Desktop auto-configuration（`kagura mcp install`）
- Diagnostics（`kagura mcp doctor`）

---

## 🗺️ Roadmap

### v4.0.0 - Memory Platform Foundation (3 months)

**Phase A: MCP-First**（1 month）
- [ ] Core refactoring（memory-first）
- [ ] REST API（FastAPI）
- [ ] MCP tools v1.0 implementation
- [ ] Tool management CLI（#331）
- [ ] Documentation rewrite

**Phase B: GraphMemory**（2 months）
- [ ] GraphMemory implementation（#345）
- [ ] MCP graph tools
- [ ] Consolidation（short → long-term）
- [ ] Export/Import（JSONL）
- [ ] Stable release

**Launch**:
- [ ] v4.0.0 tag + PyPI
- [ ] Hacker News - "Show HN: Kagura - Universal Memory Layer for AI"
- [ ] Blog post, Reddit posts

### v4.1.0 - Self-hosted API & Consumer App (4-6 months)

**Phase C: Self-hosted**
- [ ] API authentication（API Key, OAuth2）
- [ ] Production Docker setup（Postgres + pgvector + Redis）
- [ ] Connectors: GitHub, Calendar, Files

**Phase D: Consumer App**（parallel）
- [ ] Flutter app（iOS/Android/Desktop）
- [ ] Memory Browser, Graph Viewer, Insights
- [ ] App Store / Google Play submission

### v4.2.0 - Cloud & Enterprise (6-12 months)

**Phase E: Cloud SaaS**
- [ ] Multi-tenant architecture
- [ ] BYOK, RLS, SSO
- [ ] Team collaboration
- [ ] Billing system

See [V4.0_IMPLEMENTATION_ROADMAP.md](../ai_docs/V4.0_IMPLEMENTATION_ROADMAP.md) for details.

---

## 📊 Competitive Analysis

### Direct Competitors

| Feature | Mem0 | Zep | Anthropic MCP | **Kagura v4.0** |
|---------|------|-----|---------------|-----------------|
| **MCP** | ✅ 2025 | ❌ | ✅ Official | ✅ |
| **OSS** | ✅ SDK | ❌ | ✅ MIT | ✅ Apache 2.0 |
| **Local-first** | ❌ | ❌ | ✅ | ✅ |
| **Self-hosted** | ❓ | ❌ | N/A | ✅ v4.1+ |
| **Graph Memory** | ❓ | ✅ | ✅ | ✅ NetworkX |
| **RAG** | ✅ | ✅ | ❌ | ✅ |
| **Consumer App** | ❌ | ❌ | ❌ | ✅ v4.1 |
| **Vibe Coding** | ❌ | ❌ | ❌ | ✅ |

**Differentiation**:
- ✅ **Vibe Coding**: Developer interaction history tracking
- ✅ **Complete data portability**: Export/Import JSONL
- ✅ **3-tier deployment**: Local/Self-hosted/Cloud
- ✅ **Japanese-first**: Documentation, community

See [V4.0_COMPETITIVE_ANALYSIS.md](../ai_docs/V4.0_COMPETITIVE_ANALYSIS.md) for full analysis.

---

## 🎯 Success Metrics

### Technical (v4.0)
- [ ] Setup time: < 10 minutes
- [ ] Recall@5: > 0.85
- [ ] p95 latency: < 100ms
- [ ] Export success rate: > 99%
- [ ] Test coverage: > 90%

### User Adoption (v4.0)
- [ ] 500 MAU（Monthly Active Users）
- [ ] 1,000 GitHub stars
- [ ] 50+ MCP installations
- [ ] NPS: 40+

### Business (v4.1+)
- [ ] 100 paying users
- [ ] $1,000 MRR
- [ ] 10+ custom connectors（community）

---

## 🤔 Open Questions

### 1. Repository Structure
**Options**:
- **A**: Monorepo継続（`/core`, `/mcp`, `/api`, `/app`）
- **B**: 新規リポジトリ `kagura-memory`（core） + 既存 `kagura-ai`（SDK/examples）
- **C**: Monorepo + workspace（npm style）

**Recommendation**: **Option A**（monorepo）for simplicity

### 2. Chat機能の扱い
**Options**:
- **A**: 完全削除
- **B**: 最小限残す（MCP testing）
- **C**: 機能維持（別途メンテ）

**Recommendation**: **Option B**（minimal for testing）

### 3. Consumer Appのタイミング
**Options**:
- **A**: v4.0と同時開発
- **B**: v4.1で分離
- **C**: v4.2以降

**Recommendation**: **Option B**（v4.1）to focus on core first

### 4. マネタイズ戦略
**Options**:
- **A**: 完全無料（寄付ベース）
- **B**: Freemium（Cloud sync premium）
- **C**: Open Core（Enterprise機能有料）

**Recommendation**: **Option C**（Open Core）for sustainability

### 5. 既存ユーザーの移行
**Concern**: v3.0 → v4.0で破壊的変更

**Mitigation**:
- [ ] Migration guide
- [ ] v3.x LTS support（6 months）
- [ ] Automated migration tool
- [ ] Community support

---

## 📚 Related Documents

**Strategic**:
- [V4.0_STRATEGIC_PIVOT.md](../ai_docs/V4.0_STRATEGIC_PIVOT.md) - Full strategic overview
- [V4.0_README_DRAFT.md](../ai_docs/V4.0_README_DRAFT.md) - New README

**Technical**:
- [V4.0_IMPLEMENTATION_ROADMAP.md](../ai_docs/V4.0_IMPLEMENTATION_ROADMAP.md) - Implementation plan
- [V4.0_COMPETITIVE_ANALYSIS.md](../ai_docs/V4.0_COMPETITIVE_ANALYSIS.md) - Market analysis

**Related Issues**:
- #331: MCP Enhancement Roadmap
- #345: GraphDB Memory Integration
- #348: Neural Memory Research

---

## 💬 Discussion Points

### For Community Feedback

1. **Direction**: Do you agree with the pivot to Memory Platform?
2. **Features**: Which features are most important to you?
   - [ ] MCP integration
   - [ ] Consumer app
   - [ ] Self-hosted API
   - [ ] Cloud SaaS
   - [ ] GitHub connector
   - [ ] Other:（comment below）
3. **Concerns**: Any risks or concerns about this pivot?
4. **Use Cases**: How would you use Kagura v4.0?

### For Contributors

1. **Skill Areas**: Where can you contribute?
   - [ ] Core development（Python）
   - [ ] MCP tools
   - [ ] Consumer app（Flutter）
   - [ ] Documentation
   - [ ] Testing
   - [ ] Design（UI/UX）
   - [ ] Marketing
2. **Timeline**: Any concerns about the 8-12 month timeline?
3. **Technical**: Feedback on architecture decisions?

---

## ✅ Next Steps

### If Approved
1. [ ] Create v4.0.0-alpha milestone
2. [ ] Break down into implementable issues
3. [ ] Set up project board
4. [ ] Announce pivot（blog post）
5. [ ] Start Phase A implementation

### If Not Approved
- Iterate on this RFC based on feedback
- Consider alternative approaches
- Re-submit for discussion

---

## 🙋 Questions?

Please comment below with:
- Questions
- Concerns
- Suggestions
- Alternative proposals

**All feedback welcome!** This is a major strategic decision and we want to get it right.

---

**Author**: @jfk
**Co-authored**: Claude Code, ChatGPT 5 Pro
**Date**: 2025-10-25
**Status**: 📋 Proposal（Awaiting Community Feedback）

---

## 📎 Appendix: Implementation Pieces（ChatGPT 5 Pro）

Provided implementation code（zipファイル）:

1. **nmn_poc_v02.zip**: Memory API v0.2（pgvector + FastAPI）
2. **nmn_poc_v01.zip**: Minimal in-memory prototype
3. **nmn_mcp_tools.zip**: MCP tools server（recall/feedback/forget）
4. **nmn_bench.zip**: Benchmark suite（pgvector/FAISS）

These can jumpstart Phase A implementation.

---

**Let's build the future of AI memory together!** 🚀
